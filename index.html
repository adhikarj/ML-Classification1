<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>mHealth ONNX Model</title>

  <!-- ONNX Runtime Web -->
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
</head>

<body>

<h2>mHealth Activity Prediction</h2>

<!-- Input boxes -->
<div id="inputs"></div>

<button onclick="runModel()">Predict</button>

<p id="output"></p>

<script>
  // Feature names based on your dataset
  const FEATURES = [
    "Acceleration (Left Wrist) X-axis (alx)",
    "Acceleration (Left Wrist) Y-axis (aly)",
    "Acceleration (Left Wrist) Z-axis (alz)",
    "Gyroscope (Left Wrist) X-axis (glx)",
    "Gyroscope (Left Wrist) Y-axis (gly)",
    "Gyroscope (Left Wrist) Z-axis (glz)",
    "Acceleration (Right Wrist) X-axis (arx)",
    "Acceleration (Right Wrist) Y-axis (ary)",
    "Acceleration (Right Wrist) Z-axis (arz)",
    "Gyroscope (Right Wrist) X-axis (grx)",
    "Gyroscope (Right Wrist) Y-axis (gry)",
    "Gyroscope (Right Wrist) Z-axis (grz)"
  ];

  let inputsDiv = document.getElementById("inputs");

  // Create labeled input boxes
  FEATURES.forEach((feature, i) => {
    inputsDiv.innerHTML += `
      <label>${feature}: </label>
      <input id="f${i}" type="number" step="any"><br><br>
    `;
  });

  async function runModel() {
    const output = document.getElementById("output");
    output.innerText = "Loading model...";

    // Collect inputs into Float32Array
    let arr = new Float32Array(FEATURES.length);
    for (let i = 0; i < FEATURES.length; i++) {
      arr[i] = parseFloat(document.getElementById(`f${i}`).value) || 0;
    }

    try {
      // Load ONNX model
      const session = await ort.InferenceSession.create("mhealth_best_model.onnx");

      // Create tensor
      const tensor = new ort.Tensor("float32", arr, [1, FEATURES.length]);

      // Run inference
      const inputName = session.inputNames[0];
      const results = await session.run({ [inputName]: tensor });

      // Get output scores
      const outputName = session.outputNames[0];
      const scores = results[outputName].data;

      // Pick the class with highest score
      const predictedClass = scores.indexOf(Math.max(...scores));

      output.innerText = "Predicted Activity Class: " + predictedClass;

    } catch (err) {
      output.innerText = "Error: " + err;
    }
  }
</script>

</body>
</html>
